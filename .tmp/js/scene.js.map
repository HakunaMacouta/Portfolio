{"version":3,"sources":["scene.js"],"names":["camera","scene","renderer","controls","seaGeometry","seaShader","seaMesh","birds","bird","initScene","initMesh","initGeometry","initShader","initSeaMesh","animate","lightHouse","THREE","PerspectiveCamera","window","innerWidth","innerHeight","position","set","OrbitControls","update","Scene","background","Color","axesHelper","AxesHelper","add","gridHelper","GridHelper","WebGLRenderer","antialias","setSize","document","body","appendChild","domElement","CubeTextureLoader","setPath","load","loadObj","initBirds","boids","i","boid","Boid","x","Math","random","y","z","velocity","setAvoidWalls","setWorldSize","Mesh","Bird","MeshBasicMaterial","color","side","DoubleSide","phase","floor","path","callbackOnSuccess","obj","mtlLoader","MTLLoader","setTexturePath","materials","preload","objLoader","OBJLoader","setMaterials","object","scale","console","warn","error","e","requestAnimationFrame","animateBirds","uniforms","uTime","value","render","il","length","run","copy","material","r","g","b","rotation","atan2","asin","max","geometry","vertices","sin"],"mappings":"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","file":"scene.js","sourcesContent":["var camera, scene, renderer, controls;\nvar seaGeometry, seaShader, seaMesh;\nvar birds, bird;\n\ninitScene();\ninitMesh();\ninitGeometry();\ninitShader();\ninitSeaMesh();\nanimate();\n\nvar lightHouse;\n\nfunction initScene() {\n    /** CAMERA **/\n    camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 1000 );\n    camera.position.set( 0, 20, 100 );\n\n    /** CONTROLS **/\n    controls = new THREE.OrbitControls(camera);\n    controls.update();\n    /** SCENE **/\n    scene = new THREE.Scene();\n    scene.background = new THREE.Color( 0xff0000 );\n\n    /** HELPERS **/\n    var axesHelper = new THREE.AxesHelper( 100 );\n    scene.add( axesHelper );\n\n    var gridHelper = new THREE.GridHelper( 100, 100 );\n    scene.add( gridHelper );\n\n    /** CALLBACKS **/\n\n    /** RENDERER **/\n    renderer = new THREE.WebGLRenderer( { antialias: true } );\n    renderer.setSize( window.innerWidth, window.innerHeight );\n    document.body.appendChild( renderer.domElement );\n}\n\nfunction initMesh() {\n\n    /** BACKGROUND **/\n    scene.background = new THREE.CubeTextureLoader()\n        .setPath( '../images/CloudyCrown_01_Midday/Textures/' )\n        .load( [\n            'CloudyCrown_Midday_Left.png',\n            'CloudyCrown_Midday_Front.png',\n            'CloudyCrown_Midday_Up.png',\n            'CloudyCrown_Midday_Down.png',\n            'CloudyCrown_Midday_Right.png',\n            'CloudyCrown_Midday_Back.png'\n        ] );\n    /** LIGHTHOUSE **/\n    loadObj(\"../model/lighthouse/\");\n    initBirds();\n}\nfunction initBirds() {\n    birds = [];\n    boids = [];\n\n    for ( var i = 0; i < 200; i ++ ) {\n\n        boid = boids[ i ] = new Boid();\n        boid.position.x = Math.random() * 400 - 200;\n        boid.position.y = Math.random() * 400 - 200;\n        boid.position.z = Math.random() * 400 - 200;\n        boid.velocity.x = Math.random() * 2 - 1;\n        boid.velocity.y = Math.random() * 2 - 1;\n        boid.velocity.z = Math.random() * 2 - 1;\n        boid.setAvoidWalls( true );\n        boid.setWorldSize( 500, 500, 400 );\n\n        bird = birds[ i ] = new THREE.Mesh( new Bird(), new THREE.MeshBasicMaterial( { color:Math.random() * 0xffffff, side: THREE.DoubleSide } ) );\n        bird.phase = Math.floor( Math.random() * 62.83 );\n        scene.add( bird );\n\n\n    }\n}\n\nfunction loadObj(path, callbackOnSuccess) {\n    var obj;\n    var mtlLoader = new THREE.MTLLoader();\n    mtlLoader.setTexturePath(path);\n    mtlLoader.load( path + \"lighthouse.mtl\", function( materials ) {\n        materials.preload();\n        var objLoader = new THREE.OBJLoader();\n        objLoader.setMaterials( materials );\n        objLoader.load( path + \"lighthouse.obj\" ,\n            //On Success\n            function ( object ) {\n                obj = object;\n                object.position.set(0,-3,-10);\n                object.scale.set(0.4,0.4,0.4);\n\n                scene.add(obj);\n            },\n            //On Progress\n            function() {\n                console.warn(\"OnProgress\");\n            },\n            //On Error\n            function() {\n                console.error(\"Obj not loaded\");\n            });\n    });\n}\n\nfunction animate(e) {\n    requestAnimationFrame( animate );\n    animateBirds();\n    seaShader.uniforms.uTime.value = e * 0.001;\n    controls.update();\n    renderer.render( scene, camera );\n\n}\n\nfunction animateBirds() {\n    for ( var i = 0, il = birds.length; i < il; i++ ) {\n\n        boid = boids[ i ];\n        boid.run( boids );\n\n        bird = birds[ i ];\n        bird.position.copy( boids[ i ].position );\n\n        var color = bird.material.color;\n        color.r = color.g = color.b = ( 500 - bird.position.z ) / 1000;\n\n        bird.rotation.y = Math.atan2( - boid.velocity.z, boid.velocity.x );\n        bird.rotation.z = Math.asin( boid.velocity.y / boid.velocity.length() );\n\n        bird.phase = ( bird.phase + ( Math.max( 0, bird.rotation.z ) + 0.1 )  ) % 62.83;\n        bird.geometry.vertices[ 5 ].y = bird.geometry.vertices[ 4 ].y = Math.sin( bird.phase ) * 5;\n    }\n}"]}